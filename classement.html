<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Classement</title>
  <link rel="icon" type="image/png" sizes="64x64" href="./favicon.png">
  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background: #41178A;
      color:white;
      text-align:center;
    }
    h1 { 
      font-size:48px; 
      margin:40px 0 20px 0; 
      color:#ffff00; 
      text-shadow: 1px 1px #000;
    }
    table { 
      margin:0 auto; 
      border-collapse: collapse; 
      width: 80%; 
      max-width:600px; 
      background-color:#28124e;
      border: 4px solid #6437b2;
    }
    th, td { 
      padding:12px; 
      border-bottom:1px solid #6437b2; 
      font-size:20px; 
    }
    th { 
      color:#FFD700; 
      background-color:#482487;
      border-bottom:3px solid #6437b2;
    }
    tr.highlight td {
      color: #5524a9;
      font-weight:bold;
      background-color:#0e136f;
    }
    .icon { 
      cursor:pointer; 
      width:105px; 
      position:fixed; 
      top:10px; 
    }
    .icon.home { left:10px; }
    .icon.refresh { right:10px; }
  </style>
</head>
<body>

  <img src="assets/logohome.png" style="width:105px; position:fixed; top:10px; left:10px;"
    onclick="window.location.href='./index.html'">
  <img src="assets/logoretour.png" style="width:105px; position:fixed; top:10px; left:125px;"
    onclick="window.location.href='./index.html'">
  <img src="assets/logorefresh.png" style="width:105px; position:fixed; top:10px; right:10px;"
    onclick="window.location.href='./classement.html'">
  
  <h1>Classement</h1>
  <table>
    <thead>
      <tr><th>Rang</th><th>Pseudo</th><th>Score</th></tr>
    </thead>
    <tbody id="leaderboardBody">
      <tr><td colspan="3">Chargement...</td></tr>
    </tbody>
  </table>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ==== Firebase ====
  firebase.initializeApp({
    apiKey: "AIzaSyBnQb5b5h62Jl4WeiKEBMeEmivbOK-B70k",
    authDomain: "bombgo-classement.firebaseapp.com",
    projectId: "bombgo-classement",
    appId: "1:113313571513:web:73863b02df8193606ef168"
  });
  const db = firebase.firestore();

  // ==== Device ID ====
  let deviceId = localStorage.getItem("deviceId");
  if(!deviceId){ 
    deviceId = crypto.randomUUID(); 
    localStorage.setItem("deviceId", deviceId); 
  }

  const leaderboardBody = document.getElementById("leaderboardBody");

  // ==== Charger le classement ====
  function loadLeaderboard(){
    db.collection("scores").get().then(snapshot=>{
      let scores = [];
      snapshot.forEach(doc => {
        scores.push({id:doc.id, ...doc.data()});
      });

      // Trier par score descendant
      scores.sort((a,b)=>b.score - a.score);

      // Vider le tableau
      leaderboardBody.innerHTML="";

      // Ajouter chaque joueur
      scores.forEach((entry,index)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${index+1}</td><td>${entry.pseudo}</td><td>${entry.score}</td>`;
        if(entry.id===deviceId) tr.classList.add("highlight");
        leaderboardBody.appendChild(tr);
      });

      if(scores.length===0){
        leaderboardBody.innerHTML="<tr><td colspan='3'>Aucun score pour le moment.</td></tr>";
      }
    }).catch(err=>{
      console.error("Erreur leaderboard:", err);
      leaderboardBody.innerHTML="<tr><td colspan='3'>Erreur de chargement du classement.</td></tr>";
    });
  }

  loadLeaderboard();

  // Recharger toutes les 5 secondes pour voir les mises Ã  jour en direct
  setInterval(loadLeaderboard,5000);
</script>

</body>
</html>
